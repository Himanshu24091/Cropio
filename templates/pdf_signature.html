{% extends "base.html" %}

{% block title %}PDF Signature - Sign Your Documents{% endblock %}

{% block page_content %}
<link rel="stylesheet" href="{{ url_for('static', filename='pdf_signature.css') }}">
<!-- Google Fonts for signature styles -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Great+Vibes&family=Sacramento&family=Alex+Brush&family=Allura&family=Kaushan+Script&display=swap" rel="stylesheet">

<div class="container mx-auto px-6 py-8">
    <!-- Header Section -->
    <div class="text-center mb-12">
        <div class="flex items-center justify-center mb-6">
            <div class="p-4 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full shadow-lg">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
            </div>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold text-slate-800 dark:text-white mb-4">
            <span class="gradient-text">PDF Signature</span>
        </h1>
        <p class="text-xl text-slate-600 dark:text-slate-300 max-w-2xl mx-auto">
            Sign your PDF documents digitally with drawn signatures, uploaded images, or typed text
        </p>
    </div>

    <!-- Step 1: Upload PDF -->
    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 mb-8">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">Step 1: Upload PDF Document</h2>
            <p class="text-slate-600 dark:text-slate-300">Select the PDF document you want to sign</p>
        </div>

        <!-- PDF Upload Drop Zone -->
<div id="pdf-dropzone" class="upload-zone">
            <div class="dropzone-content">
                <svg class="dropzone-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <h3 class="dropzone-title">Drop PDF file here</h3>
                <p class="dropzone-subtitle">or click to browse</p>
                <div class="dropzone-formats">
                    <span class="format-tag">PDF</span>
                </div>
            </div>
            <input type="file" id="pdf-input" accept=".pdf" class="hidden">
        </div>

        <!-- PDF Info -->
        <div id="pdf-info" class="pdf-info hidden">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="font-semibold text-slate-800 dark:text-white" id="pdf-name"></h3>
                    <p class="text-slate-600 dark:text-slate-300" id="pdf-details"></p>
                </div>
                <button id="change-pdf" class="btn btn-secondary">Change PDF</button>
            </div>
        </div>
    </div>

    <!-- Step 2: Create Signature -->
    <div id="signature-section" class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 mb-8 hidden">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">Step 2: Create Your Signature</h2>
            <p class="text-slate-600 dark:text-slate-300">Choose how you want to create your signature</p>
        </div>

        <!-- Signature Method Tabs -->
        <div class="signature-tabs mb-6">
            <button class="tab-btn active" data-tab="draw">Draw Signature</button>
            <button class="tab-btn" data-tab="upload">Upload Image</button>
            <button class="tab-btn" data-tab="type">Type Text</button>
        </div>

        <!-- Draw Signature Tab -->
        <div id="draw-tab" class="tab-content active">
            <div class="signature-pad-container">
                <!-- Drawing Controls -->
                <div class="drawing-controls mb-4">
                    <div class="flex flex-wrap gap-4 items-center">
                        <div class="flex items-center gap-2">
                            <label class="text-sm font-medium">Pen Color:</label>
                            <input type="color" id="pen-color" value="#000000" class="w-8 h-8 rounded border">
                        </div>
                        <div class="flex items-center gap-2">
                            <label class="text-sm font-medium">Pen Size:</label>
                            <input type="range" id="pen-size" min="1" max="5" value="2" class="w-20">
                            <span id="pen-size-value" class="text-sm">2px</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <label class="text-sm font-medium">Background:</label>
                            <select id="bg-color" class="px-2 py-1 border rounded text-sm">
                                <option value="transparent">Transparent</option>
                                <option value="white">White</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Drawing Instructions -->
                <div class="drawing-instructions mb-2">
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        üí° <strong>Tips:</strong> Use a mouse or touchpad to draw your signature. Draw slowly for better accuracy.
                    </p>
                </div>
                
                <canvas id="signature-pad" class="signature-canvas" style="border: 2px solid #e2e8f0; border-radius: 8px; background-color: white; cursor: crosshair; width: 100%; max-width: 600px; height: 150px;"></canvas>
                
                <div class="signature-controls">
                    <button id="undo-signature" class="btn btn-secondary">‚Ü∂ Undo</button>
                    <button id="clear-signature" class="btn btn-secondary">üóëÔ∏è Clear</button>
                    <button id="save-signature" class="btn btn-primary">‚úì Save Signature</button>
                </div>
            </div>
        </div>

        <!-- Upload Signature Tab -->
        <div id="upload-tab" class="tab-content">
            <div class="upload-signature-container">
                <div id="signature-upload-zone" class="upload-zone">
                    <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <p>Click to upload signature image</p>
                    <p class="text-sm">PNG, JPG, JPEG, GIF</p>
                </div>
                <input type="file" id="signature-upload" accept=".png,.jpg,.jpeg,.gif" class="hidden">
            </div>
        </div>

        <!-- Type Text Tab -->
        <div id="type-tab" class="tab-content">
            <div class="text-signature-container">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Enter your name:</label>
                    <input type="text" id="signature-text" class="signature-input" placeholder="Your Name">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Font Style:</label>
                    <select id="font-style" class="signature-select">
                        <option value="arial">Arial (Clean)</option>
                        <option value="times">Times New Roman (Classic)</option>
                        <option value="georgia">Georgia (Elegant)</option>
                        <option value="brush-script">Brush Script (Handwritten)</option>
                        <option value="dancing-script">Dancing Script (Cursive)</option>
                        <option value="great-vibes">Great Vibes (Fancy)</option>
                        <option value="sacramento">Sacramento (Stylish)</option>
                        <option value="alex-brush">Alex Brush (Signature)</option>
                        <option value="allura">Allura (Script)</option>
                        <option value="kaushan">Kaushan Script (Bold)</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Font Weight:</label>
                    <select id="font-weight" class="signature-select">
                        <option value="normal">Normal</option>
                        <option value="bold">Bold</option>
                        <option value="lighter">Light</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Text Style:</label>
                    <select id="text-style" class="signature-select">
                        <option value="normal">Normal</option>
                        <option value="italic">Italic</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Font Size:</label>
                    <input type="range" id="font-size" min="20" max="60" value="40" class="signature-range">
                    <span id="font-size-value">40px</span>
                </div>
                
                <!-- Live Preview -->
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Live Preview:</label>
                    <div id="text-signature-preview" class="bg-white border-2 border-dashed border-gray-300 rounded-lg p-4 min-h-[80px] flex items-center justify-center">
                        <span class="text-gray-400" id="preview-placeholder">Type your name to see preview</span>
                        <span id="preview-text" class="hidden">Your Name</span>
                    </div>
                </div>
                
                <button id="create-text-signature" class="btn btn-primary">Create Signature</button>
            </div>
        </div>

        <!-- Signature Preview -->
        <div id="signature-preview" class="signature-preview hidden">
            <h3 class="font-semibold mb-2">Your Signature:</h3>
            <div class="signature-preview-container">
                <img id="signature-image" src="" alt="Signature Preview">
                <button id="edit-signature" class="btn btn-secondary btn-sm">Edit</button>
            </div>
        </div>
    </div>

    <!-- Step 3: Position Signature -->
    <div id="positioning-section" class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 mb-8 hidden">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">Step 3: Position Your Signature</h2>
            <p class="text-slate-600 dark:text-slate-300">Click and drag to position your signature on the document</p>
        </div>

        <!-- Page Navigation -->
        <div id="page-navigation" class="page-nav mb-4">
            <button id="prev-page" class="btn btn-secondary" disabled>Previous</button>
            <span id="page-info" class="page-info">Page 1 of 1</span>
            <button id="next-page" class="btn btn-secondary" disabled>Next</button>
        </div>

        <!-- PDF Preview with Signature Positioning -->
        <div class="pdf-preview-container">
            <div id="pdf-preview" class="pdf-preview">
                <img id="pdf-page-image" src="" alt="PDF Preview">
                <div id="signature-overlay" class="signature-overlay hidden">
                    <img id="overlay-signature" src="" alt="Signature">
                    <div class="resize-handles">
                        <div class="resize-handle nw"></div>
                        <div class="resize-handle ne"></div>
                        <div class="resize-handle sw"></div>
                        <div class="resize-handle se"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signature Controls -->
        <div class="signature-position-controls mt-4">
            <button id="apply-signature" class="btn btn-success" disabled>Apply Signature</button>
            <button id="reset-position" class="btn btn-secondary">Reset Position</button>
        </div>
    </div>

    <!-- Step 4: Download -->
    <div id="download-section" class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 hidden">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-slate-800 dark:text-white mb-2">Step 4: Download Signed PDF</h2>
            <p class="text-slate-600 dark:text-slate-300">Your document has been signed successfully!</p>
        </div>

        <div id="download-content" class="download-content">
            <!-- Download link will be inserted here -->
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loading-modal" class="loading-modal hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3 class="loading-title">Processing...</h3>
            <p class="loading-text">Please wait while we apply your signature</p>
        </div>
    </div>

    <!-- Alert Container -->
    <div id="alert-container" class="alert-container">
        <!-- Alerts will be added here -->
    </div>
</div>

<!-- Include PDF.js Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
    // Configure PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
</script>
<!-- Include Signature Pad Library -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
<!-- Include Interact.js for drag and resize -->
<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

{% endblock %}

{% block page_scripts %}
<script src="{{ url_for('static', filename='js/pdf_signature.js') }}" defer></script>
{% endblock %}
