{% extends "layout.html" %}

{% block title %}Text & OCR Processor{% endblock %}

{% block converter_form %}
<link rel="stylesheet" href="{{ url_for('static', filename='text_ocr_converters/text_ocr.css') }}">
<h1 class="text-3xl font-bold text-center mb-2">Text & OCR Processor</h1>
<p class="text-center text-muted-light dark:text-muted-dark mb-8">Process and analyze text files with advanced text processing features.</p>

<form method="post" action="{{ url_for('text_ocr.process_ocr') }}" enctype="multipart/form-data">
    <div id="drop-zone" class="p-10 text-center rounded-lg cursor-pointer">
        <p class="text-muted-light dark:text-muted-dark">Drop your text file here</p>
        <p class="text-sm my-2">or</p>
        <p class="text-primary-color font-semibold">Click to browse</p>
        <input type="file" name="ocr_file" id="file" class="hidden" required accept=".txt">
    </div>

    <div id="file-preview" class="mt-4">
        <p id="file-name" class="mt-2 text-sm text-center"></p>
    </div>
    
    <div class="my-6">
        <div class="format-info-box">
            <h3 class="format-info-title">Supported Features:</h3>
            <div class="format-info-grid">
                <span>• Text File Processing <span class="format-status-icon">✓</span></span>
                <span>• Word Count Analysis <span class="format-status-icon">✓</span></span>
                <span>• Text Search & Highlight <span class="format-status-icon">✓</span></span>
                <span>• Multiple Export Formats <span class="format-status-icon">✓</span></span>
                <span>• JSON Output Support <span class="format-status-icon">✓</span></span>
                <span>• Batch Text Processing <span class="format-status-icon">✓</span></span>
            </div>
        </div>
        <div class="ocr-settings-box">
            <div class="ocr-settings-content">
                <svg class="ocr-settings-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                </svg>
                <div>
                    <p class="ocr-settings-title">OCR Settings</p>
                    <div class="ocr-settings-grid mt-2">
                        <label class="ocr-setting-item">
                            <input type="checkbox" name="auto_enhance" checked> Auto-enhance image
                        </label>
                        <label class="ocr-setting-item">
                            <input type="checkbox" name="detect_language" checked> Auto-detect language
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <label for="language" class="block text-sm font-bold mb-2">Primary Language:</label>
        <select name="language" id="language" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-color focus:border-primary-color block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-color dark:focus:border-primary-color">
            <option value="auto" selected>Auto-detect</option>
            <option value="eng">English</option>
            <option value="hin">Hindi</option>
            <option value="spa">Spanish</option>
            <option value="fra">French</option>
            <option value="deu">German</option>
            <option value="ara">Arabic</option>
            <option value="chi_sim">Chinese (Simplified)</option>
            <option value="jpn">Japanese</option>
            <option value="kor">Korean</option>
            <option value="rus">Russian</option>
        </select>
    </div>
    
    <div class="my-6">
        <label for="output_format" class="block text-sm font-bold mb-2">Export Format:</label>
        <select name="output_format" id="output_format" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-color focus:border-primary-color block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-color dark:focus:border-primary-color">
            <option value="txt" selected>TXT - Plain Text</option>
            <option value="json">JSON - Structured Data</option>
        </select>
    </div>
    
    <div class="flex items-center justify-center">
        <button type="submit" class="btn-primary text-white font-bold py-3 px-6 rounded-full w-full">
            Process Document
        </button>
    </div>
</form>

<!-- Processing Modal -->
<div id="processing-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-8 max-w-md w-full mx-4 text-center">
        <div class="processing-animation-container mb-4">
            <div class="processing-scanner"></div>
            <svg class="processing-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
        </div>
        <h2 class="text-2xl font-bold mb-2 text-gray-900 dark:text-white">Processing Document</h2>
        <p class="text-gray-600 dark:text-gray-300 mb-4" id="processing-status">Analyzing image...</p>
        <div class="progress-bar-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2" id="progress-text">0%</p>
    </div>
</div>

<!-- Success Result Section -->
{% if ocr_result %}
<div class="result-success-box">
    <div class="result-header">
        <div class="result-icon-container">
            <svg class="result-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </div>
        <h3 class="result-title">OCR Processing Complete!</h3>
        <div class="result-stats">
            <span class="stat-item">
                <strong>Words Extracted:</strong> {{ ocr_result.word_count }}
            </span>
            <span class="stat-item">
                <strong>Confidence:</strong> {{ ocr_result.confidence }}%
            </span>
            <span class="stat-item">
                <strong>Language:</strong> {{ ocr_result.language }}
            </span>
        </div>
    </div>
    
    <div class="result-preview-container">
        <div class="result-preview-header">
            <h4 class="text-lg font-semibold">Extracted Text Preview</h4>
            <div class="preview-actions">
                <button type="button" class="preview-action-btn" onclick="copyText()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    Copy
                </button>
                <button type="button" class="preview-action-btn" onclick="toggleFullView()">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-5h-4m4 0v4m0-4l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5h-4m4 0v-4m0 4l-5-5"></path>
                    </svg>
                    Expand
                </button>
            </div>
        </div>
        <div id="text-preview" class="result-text-preview">
            <pre>{{ ocr_result.text[:500] }}{% if ocr_result.text|length > 500 %}...{% endif %}</pre>
        </div>
    </div>
    
    <div class="download-buttons-container">
        <a href="{{ url_for('text_ocr.download_file', filename=download_file, format=output_format) }}" class="download-button primary">
            <svg class="download-button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            Download {{ output_format|upper }} File
        </a>
        <a href="#" class="download-button secondary" onclick="processAnother(); return false;">
            <svg class="download-button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Process Another Document
        </a>
    </div>
</div>

<!-- Full Text Modal -->
<div id="full-text-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Full Extracted Text</h3>
            <button onclick="closeFullView()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div class="flex-1 overflow-y-auto">
            <pre class="whitespace-pre-wrap text-sm text-gray-700 dark:text-gray-300">{{ ocr_result.text }}</pre>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block converter_scripts %}
<script src="{{ url_for('static', filename='js/converter.js') }}" defer></script>
<script src="{{ url_for('static', filename='js/text_ocr_converters/text_ocr.js') }}" defer></script>
{% endblock %}