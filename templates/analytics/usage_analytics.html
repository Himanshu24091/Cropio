{% extends "base.html" %}

{% block title %}Usage Analytics - Cropio{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/analytics.css') }}">
<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}

{% block page_content %}
<div class="min-h-screen bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-900 dark:to-slate-800 py-8">
    <div class="container mx-auto px-4 max-w-7xl">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-slate-800 dark:text-white mb-2">üìä Usage Analytics</h1>
                    <p class="text-slate-600 dark:text-slate-400">Track your feature usage and conversion history</p>
                </div>

                <!-- Time Period Selector -->
                <div class="flex items-center space-x-2 bg-white dark:bg-slate-800 rounded-lg p-1 shadow-md">
                    <button onclick="changePeriod('day')" id="btn-day" class="period-btn active">Day</button>
                    <button onclick="changePeriod('week')" id="btn-week" class="period-btn">Week</button>
                    <button onclick="changePeriod('month')" id="btn-month" class="period-btn">Month</button>
                    <button onclick="changePeriod('year')" id="btn-year" class="period-btn">Year</button>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Usage Card -->
            <div class="stat-card bg-gradient-to-br from-blue-500 to-blue-600">
                <div class="stat-icon">üìà</div>
                <div class="stat-content">
                    <div class="stat-label">Total Usage</div>
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-subtitle">conversions</div>
                </div>
            </div>

            <!-- Success Rate Card -->
            <div class="stat-card bg-gradient-to-br from-green-500 to-green-600">
                <div class="stat-icon">‚úì</div>
                <div class="stat-content">
                    <div class="stat-label">Success Rate</div>
                    <div class="stat-value" id="stat-success">0%</div>
                    <div class="stat-subtitle">successful</div>
                </div>
            </div>

            <!-- Top Feature Card -->
            <div class="stat-card bg-gradient-to-br from-purple-500 to-purple-600">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-content">
                    <div class="stat-label">Top Feature</div>
                    <div class="stat-value text-lg" id="stat-top-feature">-</div>
                    <div class="stat-subtitle" id="stat-top-count">0 uses</div>
                </div>
            </div>

            <!-- Categories Card -->
            <div class="stat-card bg-gradient-to-br from-orange-500 to-orange-600">
                <div class="stat-icon">üìÅ</div>
                <div class="stat-content">
                    <div class="stat-label">Categories</div>
                    <div class="stat-value" id="stat-categories">0</div>
                    <div class="stat-subtitle">feature types</div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Usage Trend Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Usage Trend</h3>
                    <p class="chart-subtitle">Daily activity over time</p>
                </div>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <!-- Top Features Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Top Features</h3>
                    <p class="chart-subtitle">Most used conversions</p>
                </div>
                <div class="chart-container">
                    <canvas id="featuresChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Category Distribution Chart -->
        <div class="chart-card mb-8">
            <div class="chart-header">
                <h3 class="chart-title">Category Distribution</h3>
                <p class="chart-subtitle">Usage by feature category</p>
            </div>
            <div class="chart-container" style="max-height: 300px;">
                <canvas id="categoryChart"></canvas>
            </div>
        </div>

        <!-- Recent Activity Table -->
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-bold text-slate-800 dark:text-white">Recent Activity</h3>
                    <p class="text-sm text-slate-600 dark:text-slate-400">Your latest feature usage</p>
                </div>
                <button onclick="loadRecentActivity()"
                    class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors text-sm font-medium">
                    üîÑ Refresh
                </button>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-slate-200 dark:border-slate-700">
                            <th class="text-left py-3 px-4 text-sm font-semibold text-slate-700 dark:text-slate-300">
                                Feature</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-slate-700 dark:text-slate-300">
                                Category</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-slate-700 dark:text-slate-300">
                                Time</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-slate-700 dark:text-slate-300">
                                Status</th>
                        </tr>
                    </thead>
                    <tbody id="recent-activity-body">
                        <tr>
                            <td colspan="4" class="text-center py-8 text-slate-500 dark:text-slate-400">
                                Loading...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block page_scripts %}
<script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
{% endblock %}