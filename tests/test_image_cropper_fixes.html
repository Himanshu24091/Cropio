<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Cropper Fixes Test</title>
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.12/dist/cropper.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.12/dist/cropper.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin-bottom: 30px; border: 1px solid #ddd; padding: 20px; }
        .test-title { font-weight: bold; color: #333; margin-bottom: 15px; }
        .test-result { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        input[type="file"] { margin: 10px 0; }
        .crop-mode-enhanced { background: #f8f9fa; padding: 15px; border-radius: 5px; }
        .crop-tools-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 10px 0; }
        .crop-tool-item { display: flex; align-items: center; gap: 8px; }
    </style>
</head>
<body>
    <h1>Image Cropper Fixes Test</h1>
    
    <div class="test-section">
        <div class="test-title">Test 1: File Input Validation (Issue Fix #1)</div>
        <p>This tests if the file input causes "invalid form control" error:</p>
        
        <form id="test-form" novalidate>
            <input type="file" id="test-file-input" multiple accept="image/*" style="position: absolute; left: -1px; top: -1px; width: 1px; height: 1px; opacity: 0; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; tab-index: -1;">
            <label for="test-file-input" style="padding: 10px; background: #007bff; color: white; border-radius: 4px; cursor: pointer;">
                Choose Images
            </label>
            <button type="submit" style="margin-left: 10px; padding: 10px 20px;">Submit</button>
        </form>
        
        <div class="test-result info" id="file-test-result">
            Upload an image and click Submit to test file input validation.
        </div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Test 2: Interactive Crop Features Visibility (Issue Fix #2)</div>
        <p>This tests if Interactive Crop Features appear only for Free Crop mode:</p>
        
        <div style="margin: 15px 0;">
            <label><input type="radio" name="crop_mode" value="free" checked> Free Crop</label>
            <label style="margin-left: 15px;"><input type="radio" name="crop_mode" value="aspect"> Fixed Aspect</label>
            <label style="margin-left: 15px;"><input type="radio" name="crop_mode" value="shape"> Shape Crop</label>
        </div>
        
        <div class="crop-mode-enhanced" id="interactive-features" style="display: block;">
            <h4>Interactive Crop Features</h4>
            <div class="crop-tools-grid">
                <div class="crop-tool-item">
                    <input type="checkbox" id="show-grid" checked>
                    <label for="show-grid">Show Grid Overlay</label>
                </div>
                <div class="crop-tool-item">
                    <input type="checkbox" id="live-preview" checked>
                    <label for="live-preview">Live Preview Updates</label>
                </div>
                <div class="crop-tool-item">
                    <input type="checkbox" id="show-crop-info" checked>
                    <label for="show-crop-info">Show Crop Information</label>
                </div>
                <div class="crop-tool-item">
                    <input type="checkbox" id="snap-to-grid">
                    <label for="snap-to-grid">Snap to Grid Points</label>
                </div>
            </div>
        </div>
        
        <div class="test-result info" id="visibility-test-result">
            Change crop mode to see if Interactive Features show/hide correctly.
        </div>
    </div>
    
    <div class="test-section">
        <div class="test-title">Test 3: Applied Crop Data Storage (Issue Fix #3)</div>
        <p>This tests if crop data is properly stored when Apply Crop is clicked:</p>
        
        <button id="apply-crop-btn" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Apply Crop (Simulate)
        </button>
        
        <div class="test-result info" id="crop-data-test-result">
            Click "Apply Crop" to test crop data storage.
        </div>
    </div>

    <script>
        // Test 1: File input validation
        document.getElementById('test-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const fileInput = document.getElementById('test-file-input');
            const result = document.getElementById('file-test-result');
            
            if (fileInput.files.length === 0) {
                result.className = 'test-result error';
                result.textContent = 'No files selected, but no "invalid form control" error should occur.';
            } else {
                result.className = 'test-result success';
                result.textContent = `✓ Files selected: ${fileInput.files.length} file(s). No validation errors.`;
            }
        });
        
        // Test 2: Interactive features visibility
        document.querySelectorAll('input[name="crop_mode"]').forEach(radio => {
            radio.addEventListener('change', function(e) {
                const features = document.getElementById('interactive-features');
                const result = document.getElementById('visibility-test-result');
                const mode = e.target.value;
                
                if (mode === 'free') {
                    features.style.display = 'block';
                    result.className = 'test-result success';
                    result.textContent = '✓ Free Crop selected - Interactive features are visible.';
                } else {
                    features.style.display = 'none';
                    result.className = 'test-result success';
                    result.textContent = `✓ ${mode === 'aspect' ? 'Fixed Aspect' : 'Shape Crop'} selected - Interactive features are hidden.`;
                }
            });
        });
        
        // Test 3: Crop data storage simulation
        document.getElementById('apply-crop-btn').addEventListener('click', function() {
            // Simulate crop data
            const mockCropData = {
                x: 50,
                y: 30,
                width: 200,
                height: 150,
                rotate: 0,
                scaleX: 1,
                scaleY: 1
            };
            
            // Store crop data (simulating the actual function)
            window.appliedCropData = mockCropData;
            
            const result = document.getElementById('crop-data-test-result');
            
            if (window.appliedCropData) {
                result.className = 'test-result success';
                result.innerHTML = `✓ Crop data stored successfully:<br>
                    Size: ${mockCropData.width} × ${mockCropData.height}<br>
                    Position: (${mockCropData.x}, ${mockCropData.y})<br>
                    Data can be accessed via window.appliedCropData`;
            } else {
                result.className = 'test-result error';
                result.textContent = '✗ Failed to store crop data.';
            }
        });
        
        // Initialize test
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Image Cropper Fixes Test initialized');
        });
    </script>
</body>
</html>