â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        CROPIO PLATFORM - DATABASE SCHEMA
                   Security-First File Processing with Real-Time Analytics
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ USER MANAGEMENT TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚  â”‚     users       â”‚â”€â”€â”€â”€â”‚  user_sessions  â”‚                                     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                     â”‚
â”‚  â”‚ id (PK)         â”‚    â”‚ id (PK)         â”‚                                     â”‚
â”‚  â”‚ username (UK)   â”‚    â”‚ user_id (FK)    â”‚                                     â”‚
â”‚  â”‚ email (UK)      â”‚    â”‚ session_token   â”‚                                     â”‚
â”‚  â”‚ password_hash   â”‚    â”‚ ip_address      â”‚                                     â”‚
â”‚  â”‚ first_name      â”‚    â”‚ user_agent      â”‚                                     â”‚
â”‚  â”‚ last_name       â”‚    â”‚ created_at      â”‚                                     â”‚
â”‚  â”‚ role            â”‚    â”‚ expires_at      â”‚                                     â”‚
â”‚  â”‚ is_active       â”‚    â”‚ is_active       â”‚                                     â”‚
â”‚  â”‚ email_verified  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚  â”‚ created_at      â”‚                                                            â”‚
â”‚  â”‚ updated_at      â”‚                                                            â”‚
â”‚  â”‚ last_login      â”‚                                                            â”‚
â”‚  â”‚ login_attempts  â”‚                                                            â”‚
â”‚  â”‚ locked_until    â”‚                                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ FILE PROCESSING TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚  file_operations    â”‚â”€â”€â”€â”€â”‚   file_metadata     â”‚                             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚  â”‚ id (PK)             â”‚    â”‚ id (PK)             â”‚                             â”‚
â”‚  â”‚ user_id (FK)        â”‚    â”‚ file_operation_id   â”‚                             â”‚
â”‚  â”‚ session_id          â”‚    â”‚ file_hash (UK)      â”‚                             â”‚
â”‚  â”‚ operation_type      â”‚    â”‚ mime_type           â”‚                             â”‚
â”‚  â”‚ operation_subtype   â”‚    â”‚ actual_mime_type    â”‚                             â”‚
â”‚  â”‚ status              â”‚    â”‚ file_extension      â”‚                             â”‚
â”‚  â”‚ input_file_path     â”‚    â”‚ file_size_bytes     â”‚                             â”‚
â”‚  â”‚ output_file_path    â”‚    â”‚ is_suspicious       â”‚                             â”‚
â”‚  â”‚ original_filename   â”‚    â”‚ malware_scan_result â”‚                             â”‚
â”‚  â”‚ processed_filename  â”‚    â”‚ malware_scanner     â”‚                             â”‚
â”‚  â”‚ file_size_bytes     â”‚    â”‚ scan_timestamp      â”‚                             â”‚
â”‚  â”‚ processed_file_size â”‚    â”‚ exif_data (JSONB)   â”‚                             â”‚
â”‚  â”‚ processing_time_ms  â”‚    â”‚ pdf_metadata (JSONB)â”‚                             â”‚
â”‚  â”‚ error_message       â”‚    â”‚ document_properties â”‚                             â”‚
â”‚  â”‚ metadata (JSONB)    â”‚    â”‚ created_at          â”‚                             â”‚
â”‚  â”‚ created_at          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚  â”‚ completed_at        â”‚                                                        â”‚
â”‚  â”‚ expires_at          â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SECURITY & MONITORING TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚  sec_request_log    â”‚                                                         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                         â”‚
â”‚  â”‚ id (PK)             â”‚                                                         â”‚
â”‚  â”‚ user_id (FK)        â”‚                                                         â”‚
â”‚  â”‚ session_id          â”‚                                                         â”‚
â”‚  â”‚ ip_address          â”‚                                                         â”‚
â”‚  â”‚ user_agent          â”‚                                                         â”‚
â”‚  â”‚ request_method      â”‚                                                         â”‚
â”‚  â”‚ request_path        â”‚                                                         â”‚
â”‚  â”‚ request_size_bytes  â”‚                                                         â”‚
â”‚  â”‚ response_status     â”‚                                                         â”‚
â”‚  â”‚ response_time_ms    â”‚                                                         â”‚
â”‚  â”‚ country_code        â”‚                                                         â”‚
â”‚  â”‚ region              â”‚                                                         â”‚
â”‚  â”‚ city                â”‚                                                         â”‚
â”‚  â”‚ is_suspicious       â”‚                                                         â”‚
â”‚  â”‚ risk_score (0-100)  â”‚                                                         â”‚
â”‚  â”‚ threat_indicators   â”‚                                                         â”‚
â”‚  â”‚ created_at          â”‚                                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚   sec_blocklist     â”‚    â”‚   sec_incidents     â”‚                             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚  â”‚ id (PK)             â”‚    â”‚ id (PK)             â”‚                             â”‚
â”‚  â”‚ ip_address          â”‚    â”‚ incident_type       â”‚                             â”‚
â”‚  â”‚ ip_range (CIDR)     â”‚    â”‚ severity            â”‚                             â”‚
â”‚  â”‚ block_type          â”‚    â”‚ title               â”‚                             â”‚
â”‚  â”‚ blocked_by_user_id  â”‚    â”‚ description         â”‚                             â”‚
â”‚  â”‚ reason              â”‚    â”‚ affected_user_id    â”‚                             â”‚
â”‚  â”‚ severity            â”‚    â”‚ affected_ip         â”‚                             â”‚
â”‚  â”‚ is_active           â”‚    â”‚ source_data (JSONB) â”‚                             â”‚
â”‚  â”‚ expires_at          â”‚    â”‚ status              â”‚                             â”‚
â”‚  â”‚ created_at          â”‚    â”‚ assigned_to_user_id â”‚                             â”‚
â”‚  â”‚ updated_at          â”‚    â”‚ resolution_notes    â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ created_at          â”‚                             â”‚
â”‚                             â”‚ resolved_at         â”‚                             â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ SYSTEM CONFIGURATION TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚   app_settings      â”‚    â”‚   feature_flags     â”‚                             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚  â”‚ id (PK)             â”‚    â”‚ id (PK)             â”‚                             â”‚
â”‚  â”‚ setting_key (UK)    â”‚    â”‚ flag_name (UK)      â”‚                             â”‚
â”‚  â”‚ setting_value       â”‚    â”‚ is_enabled          â”‚                             â”‚
â”‚  â”‚ setting_type        â”‚    â”‚ rollout_percentage  â”‚                             â”‚
â”‚  â”‚ description         â”‚    â”‚ target_users (JSONB)â”‚                             â”‚
â”‚  â”‚ is_public           â”‚    â”‚ description         â”‚                             â”‚
â”‚  â”‚ created_at          â”‚    â”‚ created_at          â”‚                             â”‚
â”‚  â”‚ updated_at          â”‚    â”‚ updated_at          â”‚                             â”‚
â”‚  â”‚ updated_by_user_id  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ANALYTICS & REPORTING TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚  usage_analytics    â”‚                                                         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                         â”‚
â”‚  â”‚ id (PK)             â”‚                                                         â”‚
â”‚  â”‚ event_type          â”‚                                                         â”‚
â”‚  â”‚ user_id (FK)        â”‚                                                         â”‚
â”‚  â”‚ session_id          â”‚                                                         â”‚
â”‚  â”‚ ip_address          â”‚                                                         â”‚
â”‚  â”‚ user_agent          â”‚                                                         â”‚
â”‚  â”‚ page_path           â”‚                                                         â”‚
â”‚  â”‚ referrer            â”‚                                                         â”‚
â”‚  â”‚ event_data (JSONB)  â”‚                                                         â”‚
â”‚  â”‚ created_at          â”‚                                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚    daily_stats      â”‚    â”‚     audit_log       â”‚                             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚  â”‚ id (PK)             â”‚    â”‚ id (PK)             â”‚                             â”‚
â”‚  â”‚ date (UK)           â”‚    â”‚ user_id (FK)        â”‚                             â”‚
â”‚  â”‚ total_users         â”‚    â”‚ action              â”‚                             â”‚
â”‚  â”‚ new_users           â”‚    â”‚ resource_type       â”‚                             â”‚
â”‚  â”‚ total_files_processedâ”‚   â”‚ resource_id         â”‚                             â”‚
â”‚  â”‚ total_data_bytes    â”‚    â”‚ old_values (JSONB)  â”‚                             â”‚
â”‚  â”‚ successful_ops      â”‚    â”‚ new_values (JSONB)  â”‚                             â”‚
â”‚  â”‚ failed_operations   â”‚    â”‚ ip_address          â”‚                             â”‚
â”‚  â”‚ security_incidents  â”‚    â”‚ user_agent          â”‚                             â”‚
â”‚  â”‚ blocked_requests    â”‚    â”‚ success             â”‚                             â”‚
â”‚  â”‚ unique_ips          â”‚    â”‚ error_message       â”‚                             â”‚
â”‚  â”‚ created_at          â”‚    â”‚ created_at          â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              RELATIONSHIP OVERVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ PRIMARY RELATIONSHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  users (1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) user_sessions                                          â”‚
â”‚    â”‚                                                                             â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) file_operations                                       â”‚
â”‚    â”‚                         â”‚                                                   â”‚
â”‚    â”‚                         â””â”€â”€â”€â”€ (1) file_metadata                            â”‚
â”‚    â”‚                                                                             â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) sec_request_log                                       â”‚
â”‚    â”‚                                                                             â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) sec_blocklist (as blocker)                           â”‚
â”‚    â”‚                                                                             â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) sec_incidents (as affected_user)                     â”‚
â”‚    â”‚                                                                             â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) sec_incidents (as assigned_admin)                    â”‚
â”‚    â”‚                                                                             â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) app_settings (as updater)                            â”‚
â”‚    â”‚                                                                             â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) usage_analytics                                       â”‚
â”‚    â”‚                                                                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ (N) audit_log                                             â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                KEY CONSTRAINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ CHECK CONSTRAINTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  â€¢ users.role IN ('admin', 'user', 'moderator')                                 â”‚
â”‚                                                                                   â”‚
â”‚  â€¢ file_operations.status IN ('pending', 'processing', 'completed',             â”‚
â”‚                               'failed', 'quarantined')                          â”‚
â”‚                                                                                   â”‚
â”‚  â€¢ file_metadata.malware_scan_result IN ('clean', 'infected',                   â”‚
â”‚                                          'suspicious', 'pending')               â”‚
â”‚                                                                                   â”‚
â”‚  â€¢ sec_request_log.risk_score >= 0 AND risk_score <= 100                       â”‚
â”‚                                                                                   â”‚
â”‚  â€¢ sec_blocklist.block_type IN ('manual', 'auto', 'geo', 'reputation')         â”‚
â”‚  â€¢ sec_blocklist.severity IN ('low', 'medium', 'high', 'critical')             â”‚
â”‚                                                                                   â”‚
â”‚  â€¢ sec_incidents.severity IN ('low', 'medium', 'high', 'critical')             â”‚
â”‚  â€¢ sec_incidents.status IN ('open', 'investigating', 'resolved',               â”‚
â”‚                             'false_positive')                                   â”‚
â”‚                                                                                   â”‚
â”‚  â€¢ app_settings.setting_type IN ('string', 'integer', 'boolean', 'json')       â”‚
â”‚                                                                                   â”‚
â”‚  â€¢ feature_flags.rollout_percentage >= 0 AND rollout_percentage <= 100         â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ BUSINESS RULES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  â€¢ Either user_id OR session_id must be present in file_operations              â”‚
â”‚  â€¢ Either ip_address OR ip_range must be present in sec_blocklist               â”‚
â”‚  â€¢ file_metadata.file_hash must be uppercase SHA-256 format                     â”‚
â”‚  â€¢ Auto-cleanup of expired file_operations based on expires_at                  â”‚
â”‚  â€¢ Session management with automatic expiration                                  â”‚
â”‚  â€¢ Geographic data collection for security analysis                              â”‚
â”‚  â€¢ Real-time risk scoring and threat detection                                   â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              PERFORMANCE INDEXES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ KEY INDEXES FOR PERFORMANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  ðŸ” USERS TABLE:                                                                 â”‚
â”‚     â€¢ idx_users_email (email)                                                   â”‚
â”‚     â€¢ idx_users_username (username)                                             â”‚
â”‚     â€¢ idx_users_role_active (role, is_active)                                   â”‚
â”‚                                                                                   â”‚
â”‚  ðŸ” FILE_OPERATIONS TABLE:                                                       â”‚
â”‚     â€¢ idx_file_operations_user_id (user_id)                                     â”‚
â”‚     â€¢ idx_file_operations_status (status)                                       â”‚
â”‚     â€¢ idx_file_operations_type (operation_type, operation_subtype)              â”‚
â”‚     â€¢ idx_file_operations_expires_at (expires_at)                               â”‚
â”‚                                                                                   â”‚
â”‚  ðŸ” SEC_REQUEST_LOG TABLE:                                                       â”‚
â”‚     â€¢ idx_sec_request_log_ip_address (ip_address)                               â”‚
â”‚     â€¢ idx_sec_request_log_created_at (created_at)                               â”‚
â”‚     â€¢ idx_sec_request_log_suspicious (is_suspicious WHERE is_suspicious)        â”‚
â”‚     â€¢ idx_sec_request_log_risk_score (risk_score)                               â”‚
â”‚                                                                                   â”‚
â”‚  ðŸ” SEC_BLOCKLIST TABLE:                                                         â”‚
â”‚     â€¢ idx_sec_blocklist_ip_address (ip_address)                                 â”‚
â”‚     â€¢ idx_sec_blocklist_active (is_active WHERE is_active)                      â”‚
â”‚                                                                                   â”‚
â”‚  ðŸ” FILE_METADATA TABLE:                                                         â”‚
â”‚     â€¢ idx_file_metadata_hash (file_hash)                                        â”‚
â”‚     â€¢ idx_file_metadata_suspicious (is_suspicious WHERE is_suspicious)          â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              IMPLEMENTATION NOTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â€¢ PK = Primary Key, FK = Foreign Key, UK = Unique Key
â€¢ JSONB fields provide flexible storage for metadata and configuration
â€¢ Timestamp fields use TIMESTAMP WITH TIME ZONE for proper timezone handling
â€¢ Security-first design with comprehensive logging and monitoring
â€¢ File processing pipeline with quarantine and validation system
â€¢ Real-time analytics with pre-aggregated statistics for performance
â€¢ Feature flag system for gradual rollouts and A/B testing
â€¢ Complete audit trail for compliance and debugging

Created by: Himanshu | Version: 2.0.0 | License: MIT
